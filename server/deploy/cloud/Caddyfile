{
	email {$CADDY_ADMIN_EMAIL}
	auto_https on
	order reverse_proxy first
}

api.hanbaodoudou.com {
	encode zstd gzip

	log {
		output file /var/log/caddy/api-access.log {
			roll_size 10MiB
			roll_keep 14
			roll_keep_for 240h
		}
		format json
	}

	header {
		Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
		Referrer-Policy "strict-origin-when-cross-origin"
		X-Content-Type-Options "nosniff"
		X-Frame-Options "DENY"
	}

	reverse_proxy 127.0.0.1:8080 {
		health_uri /health
		health_interval 30s
		health_timeout 5s
		header_up X-Forwarded-Proto {scheme}
		header_up X-Forwarded-For {remote_host}
		header_up X-Forwarded-Port {server_port}
	}
}
